{% extends 'base.html' %}
{% block title %}
  {% if is_edit %}
  Edit post
  {% else %}
    New post
  {% endif %}
{% endblock %}
{% block content %}
  {% load user_filters %} 
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card rounded mb-4 shadow-sm">
        <div class="card-body">
          <h1 class="fw-bold text-center">
            {% if is_edit %}
            Edit post
            {% else %}
            New post
            {% endif %}
          </h1>
          <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            {% for field in form %}
              {% if field.name != 'image' %}
                <div class="form-group row my-3">
                  <label>{{ field.label }}
                    {% if field.field.required %}*{% endif %}
                  </label>
                  <div>
                    {{ field|addclass:'form-control' }}
                    <small class="form-text text-muted">{{ field.help_text|safe }}</small>
                  </div>
                </div>
              {% endif %}
            {% endfor %}
            <div class="form-group row my-3">
              <label>Image</label>
              <div class="text-center">
                <div style="max-width: 300px; max-height: 300px; margin: 0 auto;">
                  <img id="image-preview" src="#" alt="Image Preview" style="display: none; max-width: 100%; max-height: 100%;">
                </div>
                <input type="file" id="image-input" name="image" accept="image/*" onchange="previewImage(event)">
                <small class="form-text text-muted">Upload an image</small>
              </div>
            </div>
            <div class="d-flex justify-content-end">
              <button type="submit" class="btn btn-primary">
                {% if is_edit %}
                Save
                {% else %}
                Add
                {% endif %}
              </button>
            </div>
          </form>
          
          <script>
          function previewImage(event) {
            var input = event.target;
            var preview = document.getElementById('image-preview');
          
            if (input.files && input.files[0]) {
              var reader = new FileReader();
          
              reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
              };
          
              reader.readAsDataURL(input.files[0]);
            }
          }
          </script>          
        </div>
      </div>
    </div>
  </div>
{% endblock %}
